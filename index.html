<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Manager - Firebase</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <style>
        /* Custom scrollbar for better UI */
        .overflow-y-auto::-webkit-scrollbar {
            width: 8px;
        }
        .overflow-y-auto::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        @media print {
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // üõë 2. FIREBASE CONFIGURATION (REPLACE WITH YOUR KEYS) üõë
        const firebaseConfig = {
          apiKey: "YOUR_API_KEY",
          authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
          projectId: "YOUR_PROJECT_ID",
          storageBucket: "YOUR_PROJECT_ID.appspot.com",
          messagingSenderId: "SENDER_ID",
          appId: "APP_ID"
        };

        // Initialize Firebase and Firestore
        const app = firebase.initializeApp(firebaseConfig);
        const db = app.firestore();
        // Define collection references
        const travelersCol = db.collection("travelers");
        const expensesCol = db.collection("expenses");
        
        // Initial Data (only used if Firebase collections are empty)
        const initialTravelers = [
            { id: 't1', name: 'John Doe', transport: 'Plane', arrival: 'Nov 26', departure: 'Nov 30', status: 'Confirmed' },
            { id: 't2', name: 'Jane Smith', transport: 'Train', arrival: 'Nov 27', departure: 'Dec 01', status: 'Confirmed' },
            // ... (rest of initial travelers)
        ];
        const initialExpenses = [
            { id: 'e1', date: 'Nov 25', description: 'Accommodation Deposit', amount: 6000, splitType: 'Equal', paidBy: 'Sarah Lee', status: 'Confirmed' },
            // ... (rest of initial expenses)
        ];

        // Helper to format date for input defaults (remains the same)
        const getFormattedDate = (date) => {
            const d = date ? new Date(date) : new Date();
            const month = d.toLocaleString('en-US', { month: 'short' });
            const day = d.getDate().toString().padStart(2, '0');
            return `${month} ${day}`;
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('travelers');
            const [travelers, setTravelers] = useState([]);
            const [expenses, setExpenses] = useState([]);
            const [loading, setLoading] = useState(true);

            // üõë 3. FIREBASE DATA FETCH (REPLACES useEffect with localStorage) üõë
            useEffect(() => {
                const unsubscribeTravelers = travelersCol.onSnapshot(snapshot => {
                    const travelerData = snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
                    setTravelers(travelerData);
                    setLoading(false);
                }, error => {
                    console.error("Error fetching travelers:", error);
                    setLoading(false);
                });

                const unsubscribeExpenses = expensesCol.onSnapshot(snapshot => {
                    const expenseData = snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
                    setExpenses(expenseData);
                    setLoading(false);
                }, error => {
                    console.error("Error fetching expenses:", error);
                    setLoading(false);
                });

                // Cleanup subscription on component unmount
                return () => {
                    unsubscribeTravelers();
                    unsubscribeExpenses();
                };
            }, []);
            
            if (loading) {
                return <div className="p-10 text-center text-xl font-semibold text-gray-600">Loading trip data from Firebase...</div>;
            }
            
            // üõë 4. FIREBASE CRUD OPERATIONS (REPLACES array/localStorage operations) üõë
            
            // Traveler Handlers
            const addTraveler = async (newTraveler) => {
                try {
                    await travelersCol.add(newTraveler);
                } catch (e) {
                    console.error("Error adding document: ", e);
                }
            };

            const deleteTraveler = async (id) => {
                try {
                    await travelersCol.doc(id).delete();
                } catch (e) {
                    console.error("Error deleting document: ", e);
                }
            };

            const updateTravelerStatus = async (id, newStatus) => {
                try {
                    await travelersCol.doc(id).update({ status: newStatus });
                } catch (e) {
                    console.error("Error updating document: ", e);
                }
            };

            // Expense Handlers
            const addExpense = async (newExpense) => {
                try {
                    await expensesCol.add(newExpense);
                } catch (e) {
                    console.error("Error adding document: ", e);
                }
            };

            const deleteExpense = async (id) => {
                try {
                    await expensesCol.doc(id).delete();
                } catch (e) {
                    console.error("Error deleting document: ", e);
                }
            };

            // ... (rest of the component logic remains the same, using the new async handlers)
            
            // Note: Data Export/Import functions will need major updates to handle Firebase sync
            // For now, the old Export/Import functions are removed as they conflict with Firebase sync.

            // The rest of your existing components (TravelerCard, ExpenseSplitCalculator, IndividualBillGenerator, etc.)
            // remain functional as they rely on the `travelers` and `expenses` state variables, which are now synced by Firebase.

            // --- ALL OTHER COMPONENTS GO HERE (SAME AS PREVIOUS CODE) ---

            const getStatusColor = (status) => {
                switch (status) {
                    case 'Confirmed': return 'bg-green-100 text-green-800';
                    case 'Pending': return 'bg-yellow-100 text-yellow-800';
                    case 'Cancelled': return 'bg-red-100 text-red-800';
                    default: return 'bg-gray-100 text-gray-800';
                }
            };

            // Expense Split Logic (Same as before)
            const calculateBalances = (confirmedTravelers, confirmedExpenses) => {
                const balances = {};
                confirmedTravelers.forEach(t => balances[t.name] = 0);
                const totalShares = {};
                confirmedTravelers.forEach(t => totalShares[t.name] = 0);

                confirmedExpenses.forEach(expense => {
                    const payerName = expense.paidBy;
                    if (!balances.hasOwnProperty(payerName)) return; 
                    
                    balances[payerName] += expense.amount;
                    
                    if (expense.splitType === 'Equal') {
                        const totalParticipants = confirmedTravelers.length;
                        const perShare = expense.amount / totalParticipants;
                        
                        confirmedTravelers.forEach(t => {
                            balances[t.name] -= perShare;
                            totalShares[t.name] += perShare;
                        });
                    }
                });

                const netBalances = Object.entries(balances)
                    .map(([name, netAmount]) => ({ name, netAmount }));

                const givers = netBalances.filter(b => b.netAmount < -0.01).sort((a, b) => a.netAmount - b.netAmount); 
                const receivers = netBalances.filter(b => b.netAmount > 0.01).sort((a, b) => b.netAmount - a.netAmount); 
                const settlements = [];

                let gIdx = 0;
                let rIdx = 0;

                while (gIdx < givers.length && rIdx < receivers.length) {
                    let giver = givers[gIdx];
                    let receiver = receivers[rIdx];

                    const amount = Math.min(Math.abs(giver.netAmount), receiver.netAmount);

                    settlements.push({
                        from: giver.name,
                        to: receiver.name,
                        amount: amount.toFixed(2),
                    });

                    giver.netAmount += amount;
                    receiver.netAmount -= amount;

                    if (giver.netAmount >= -0.01) gIdx++; 
                    if (receiver.netAmount <= 0.01) rIdx++; 
                }

                return { netBalances, settlements, totalShares };
            };


            const ExpenseSplitCalculator = () => {
                const confirmedTravelers = travelers.filter(t => t.status === 'Confirmed');
                const confirmedExpenses = expenses.filter(e => e.status === 'Confirmed');

                if (confirmedTravelers.length === 0) {
                    return <div className="p-4 bg-yellow-100 text-yellow-800 rounded-md">Please confirm at least one traveler to calculate splits.</div>;
                }
                
                const equalSplitExpenses = confirmedExpenses.filter(e => e.splitType === 'Equal');

                if (equalSplitExpenses.length === 0) {
                    return <div className="p-4 bg-blue-100 text-blue-800 rounded-md">No 'Equal Split' expenses have been confirmed to calculate settlement.</div>;
                }

                const { netBalances, settlements } = calculateBalances(confirmedTravelers, equalSplitExpenses);

                return (
                    <div className="bg-white p-6 rounded-lg shadow-md border border-gray-200 mb-6">
                        <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            üí∞ Expense Settlement Breakdown
                        </h3>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {/* Net Balances */}
                            <div className="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h4 className="font-semibold text-lg text-indigo-700 mb-3 border-b pb-2">Net Balances (Who owes whom)</h4>
                                <ul className="space-y-2">
                                    {netBalances.map((b, index) => (
                                        <li key={index} className="flex justify-between text-sm">
                                            <span>{b.name}</span>
                                            <span className={`font-mono font-bold ${b.netAmount > 0 ? 'text-green-600' : b.netAmount < 0 ? 'text-red-600' : 'text-gray-500'}`}>
                                                ‚Çπ{Math.abs(b.netAmount).toFixed(2)} {b.netAmount > 0 ? '(Owed)' : b.netAmount < 0 ? '(Owes)' : ''}
                                            </span>
                                        </li>
                                    ))}
                                </ul>
                                <p className="text-xs text-gray-500 mt-2">*Calculation based on **Confirmed** 'Equal Split' expenses.</p>
                            </div>

                            {/* Settlements */}
                            <div className="bg-gray-50 p-4 rounded-lg shadow-sm">
                                <h4 className="font-semibold text-lg text-purple-700 mb-3 border-b pb-2">Settlement Steps (Minimum Transfers)</h4>
                                <ul className="space-y-2">
                                    {settlements.length > 0 ? settlements.map((s, index) => (
                                        <li key={index} className="text-sm bg-purple-100 p-2 rounded-md">
                                            <span className="font-semibold">{s.from}</span> pays <span className="font-semibold">{s.to}</span> **‚Çπ{s.amount}**
                                        </li>
                                    )) : (
                                        <li className="text-sm text-gray-600">All balances are settled (or no common expenses recorded).</li>
                                    )}
                                </ul>
                            </div>
                        </div>
                    </div>
                );
            };

            const IndividualBillGenerator = () => {
                const confirmedTravelers = travelers.filter(t => t.status === 'Confirmed');
                const confirmedExpenses = expenses.filter(e => e.status === 'Confirmed');
                const [selectedTraveler, setSelectedTraveler] = useState('');
                const componentRef = useRef();

                const travelerName = selectedTraveler;

                const handlePrint = () => {
                    window.print();
                };

                if (confirmedTravelers.length === 0) {
                    return <div className="p-4 bg-yellow-100 text-yellow-800 rounded-md">Please confirm at least one traveler to generate a bill.</div>;
                }

                const travelerExpensesPaid = confirmedExpenses.filter(e => e.paidBy === travelerName);
                const totalPaid = travelerExpensesPaid.reduce((sum, exp) => sum + exp.amount, 0);

                const { totalShares } = calculateBalances(confirmedTravelers, confirmedExpenses);
                const totalOwedShare = totalShares[travelerName] || 0;

                const netBalance = totalPaid - totalOwedShare;

                return (
                    <div className="bg-gray-50 p-6 rounded-lg shadow-md border border-gray-200 mt-6 no-print">
                        <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            üßæ Individual Bill Generator
                        </h3>
                        <div className="flex items-center space-x-4 mb-6">
                            <select
                                value={selectedTraveler}
                                onChange={(e) => setSelectedTraveler(e.target.value)}
                                className="p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500 w-full md:w-1/3"
                            >
                                <option value="">-- Select Traveler for Bill --</option>
                                {confirmedTravelers.map(t => (
                                    <option key={t.id} value={t.name}>{t.name}</option>
                                ))}
                            </select>
                            <button
                                onClick={handlePrint}
                                disabled={!selectedTraveler}
                                className={`px-4 py-2 rounded-md text-sm font-semibold ${selectedTraveler ? 'bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-300 text-gray-500 cursor-not-allowed'}`}
                            >
                                Print Bill
                            </button>
                        </div>
                        
                        {selectedTraveler && (
                            <div ref={componentRef} className="p-4 bg-white rounded-lg border-2 border-indigo-200">
                                <h4 className="text-2xl font-bold text-indigo-700 mb-4">Trip Bill for {travelerName}</h4>
                                
                                {/* Summary Box */}
                                <div className="grid grid-cols-3 gap-4 border-b pb-4 mb-4">
                                    <div className="bg-green-50 p-3 rounded-md">
                                        <p className="text-xs text-green-700 font-medium">Total Paid (Contribution)</p>
                                        <p className="text-xl font-bold text-green-900">‚Çπ{totalPaid.toFixed(2)}</p>
                                    </div>
                                    <div className="bg-red-50 p-3 rounded-md">
                                        <p className="text-xs text-red-700 font-medium">Total Share (Owed by Traveler)</p>
                                        <p className="text-xl font-bold text-red-900">‚Çπ{totalOwedShare.toFixed(2)}</p>
                                    </div>
                                    <div className={`p-3 rounded-md ${netBalance >= 0 ? 'bg-indigo-100' : 'bg-orange-100'}`}>
                                        <p className={`text-xs ${netBalance >= 0 ? 'text-indigo-700' : 'text-orange-700'} font-medium`}>Net Balance ({netBalance >= 0 ? 'Refund Due' : 'Payment Due'})</p>
                                        <p className="text-2xl font-extrabold text-indigo-900">
                                            {netBalance >= 0 ? '+' : '-'} ‚Çπ{Math.abs(netBalance).toFixed(2)}
                                        </p>
                                    </div>
                                </div>

                                {/* Details Table */}
                                <h5 className="font-semibold text-lg mb-2 text-gray-700">Detailed Contributions (Paid By {travelerName})</h5>
                                <table className="min-w-full text-sm mb-4">
                                    <thead>
                                        <tr className="bg-gray-100">
                                            <th className="px-3 py-2 text-left">Date</th>
                                            <th className="px-3 py-2 text-left">Description</th>
                                            <th className="px-3 py-2 text-right">Amount Paid</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {travelerExpensesPaid.length > 0 ? travelerExpensesPaid.map(exp => (
                                            <tr key={exp.id} className="border-b">
                                                <td className="px-3 py-2">{exp.date}</td>
                                                <td className="px-3 py-2">{exp.description} ({exp.splitType} Split)</td>
                                                <td className="px-3 py-2 text-right">‚Çπ{exp.amount.toFixed(2)}</td>
                                            </tr>
                                        )) : (
                                            <tr><td colSpan="3" className="px-3 py-2 text-center text-gray-500">No confirmed contributions recorded.</td></tr>
                                        )}
                                    </tbody>
                                </table>
                                
                                <p className="text-xs text-gray-500 mt-4">Note: The total share (‚Çπ{totalOwedShare.toFixed(2)}) is {travelerName}'s equal share of all confirmed 'Equal Split' expenses.</p>
                            </div>
                        )}
                    </div>
                );
            };

            const TabButton = ({ name, label }) => (
                <button
                    className={`px-4 py-2 text-sm font-medium focus:outline-none ${
                        activeTab === name
                            ? 'border-b-2 border-blue-500 text-blue-600'
                            : 'text-gray-600 hover:text-gray-800'
                    }`}
                    onClick={() => setActiveTab(name)}
                >
                    {label}
                </button>
            );

            const TravelerCard = ({ traveler }) => (
                <div className="bg-white rounded-lg shadow p-4 flex flex-col md:flex-row items-start md:items-center justify-between space-y-2 md:space-y-0 md:space-x-4">
                    <div className="flex-grow">
                        <div className="flex items-center space-x-2 mb-1">
                            <span className="font-bold text-gray-800">{traveler.name}</span>
                            <span className="text-sm text-gray-500">
                                {traveler.transport === 'Plane' ? '‚úàÔ∏è' : 'üöÜ'}
                            </span>
                            <span className={`px-2 py-1 rounded-full text-xs font-semibold ${getStatusColor(traveler.status)}`}>
                                {traveler.status}
                            </span>
                        </div>
                        <div className="text-xs text-gray-600">
                            Arrival: {traveler.arrival}, Departure: {traveler.departure}
                        </div>
                    </div>
                    <div className="flex space-x-2">
                           <select
                                className={`px-2 py-1 rounded-md border text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${getStatusColor(traveler.status)}`}
                                value={traveler.status}
                                onChange={(e) => updateTravelerStatus(traveler.id, e.target.value)}
                            >
                                <option value="Confirmed">Confirmed</option>
                                <option value="Pending">Pending</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        <button
                            onClick={() => deleteTraveler(traveler.id)}
                            className="text-red-500 hover:text-red-700 px-2 py-1 rounded-md bg-red-50 hover:bg-red-100 text-sm"
                        >
                            Delete
                        </button>
                    </div>
                </div>
            );

            const AddTravelerForm = () => {
                const today = getFormattedDate();
                const defaultDeparture = getFormattedDate(new Date(new Date().setDate(new Date().getDate() + 5)));
                const [name, setName] = useState('');
                const [transport, setTransport] = useState('Plane');
                const [arrival, setArrival] = useState(today);
                const [departure, setDeparture] = useState(defaultDeparture);
                const [status, setStatus] = useState('Confirmed');

                const handleSubmit = (e) => {
                    e.preventDefault();
                    if (!name) return;
                    addTraveler({ name, transport, arrival, departure, status });
                    setName('');
                    setArrival(today);
                    setDeparture(defaultDeparture);
                    setStatus('Confirmed');
                };

                return (
                    <form onSubmit={handleSubmit} className="p-4 bg-blue-50 rounded-lg shadow-sm mb-4">
                        <h3 className="text-lg font-semibold mb-2 text-blue-700">Add New Traveler</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-3">
                            <input
                                type="text"
                                placeholder="Traveler Name"
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                className="p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500"
                                required
                            />
                            <select
                                value={transport}
                                onChange={(e) => setTransport(e.target.value)}
                                className="p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500"
                            >
                                <option value="Plane">Plane</option>
                                <option value="Train">Train</option>
                            </select>
                            <input
                                type="text"
                                placeholder="Arrival Date (e.g., Nov 26)"
                                value={arrival}
                                onChange={(e) => setArrival(e.target.value)}
                                className="p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500"
                                required
                            />
                            <input
                                type="text"
                                placeholder="Departure Date (e.g., Dec 01)"
                                value={departure}
                                onChange={(e) => setDeparture(e.target.value)}
                                className="p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500"
                                required
                            />
                             <select
                                value={status}
                                onChange={(e) => setStatus(e.target.value)}
                                className="p-2 border rounded-md focus:ring-blue-500 focus:border-blue-500"
                            >
                                <option value="Confirmed">Confirmed</option>
                                <option value="Pending">Pending</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>
                        <button
                            type="submit"
                            className="w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                        >
                            Add Traveler
                        </button>
                    </form>
                );
            };

            const AddExpenseForm = () => {
                const [description, setDescription] = useState('');
                const [amount, setAmount] = useState('');
                const [splitType, setSplitType] = useState('Equal');
                const [paidBy, setPaidBy] = useState('');
                const [status, setStatus] = useState('Confirmed');

                const handleSubmit = (e) => {
                    e.preventDefault();
                    if (!description || !amount || !paidBy) return;
                    addExpense({
                        date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                        description,
                        amount: parseFloat(amount),
                        splitType,
                        paidBy,
                        status
                    });
                    setDescription('');
                    setAmount('');
                    setSplitType('Equal');
                    setPaidBy('');
                    setStatus('Confirmed');
                };

                return (
                    <form onSubmit={handleSubmit} className="p-4 bg-green-50 rounded-lg shadow-sm mb-4">
                        <h3 className="text-lg font-semibold mb-2 text-green-700">Add New Expense</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-3">
                            <input
                                type="text"
                                placeholder="Description"
                                value={description}
                                onChange={(e) => setDescription(e.target.value)}
                                className="p-2 border rounded-md focus:ring-green-500 focus:border-green-500"
                                required
                            />
                            <input
                                type="number"
                                placeholder="Amount (e.g., 6000)"
                                value={amount}
                                onChange={(e) => setAmount(e.target.value)}
                                className="p-2 border rounded-md focus:ring-green-500 focus:border-green-500"
                                required
                            />
                            <select
                                value={splitType}
                                onChange={(e) => setSplitType(e.target.value)}
                                className="p-2 border rounded-md focus:ring-green-500 focus:border-green-500"
                            >
                                <option value="Equal">Equal Split</option>
                                <option value="Individual">Individual (Not Split)</option>
                                <option value="Custom">Custom Split (Advanced)</option>
                            </select>
                             <select
                                value={paidBy}
                                onChange={(e) => setPaidBy(e.target.value)}
                                className="p-2 border rounded-md focus:ring-green-500 focus:border-green-500"
                                required
                            >
                                <option value="">-- Paid By --</option>
                                {travelers.map(t => (
                                    <option key={t.id} value={t.name}>{t.name}</option>
                                ))}
                            </select>
                            <select
                                value={status}
                                onChange={(e) => setStatus(e.target.value)}
                                className="p-2 border rounded-md focus:ring-green-500 focus:border-green-500"
                            >
                                <option value="Confirmed">Confirmed</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                        <button
                            type="submit"
                            className="w-full bg-green-600 text-white p-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"
                        >
                            Add Expense
                        </button>
                    </form>
                );
            };

            const TravelerList = () => (
                <div className="space-y-4">
                    <AddTravelerForm />
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {travelers.map(traveler => (
                            <TravelerCard key={traveler.id} traveler={traveler} />
                        ))}
                    </div>
                </div>
            );

            const ExpenseTable = () => (
                <div className="space-y-6">
                     <AddExpenseForm />
                     <ExpenseSplitCalculator />
                     <IndividualBillGenerator />
                    <div className="overflow-x-auto">
                        <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            üìã All Trip Expenses
                        </h3>
                        <table className="min-w-full bg-white rounded-lg shadow-md overflow-hidden">
                            <thead className="bg-gray-50 border-b border-gray-200">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Split Type</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Paid By</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-200">
                                {expenses.map(expense => (
                                    <tr key={expense.id}>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{expense.date}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{expense.description}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">‚Çπ{expense.amount.toLocaleString()}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{expense.splitType}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{expense.paidBy}</td>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(expense.status)}`}>
                                                {expense.status}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <button
                                                onClick={() => deleteExpense(expense.id)}
                                                className="text-red-500 hover:text-red-700 px-2 py-1 rounded-md bg-red-50 hover:bg-red-100 text-sm"
                                            >
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );

            const DailySchedule = () => {
                const tripStartDate = new Date('2025-11-26');
                const tripEndDate = new Date('2025-12-01');
                const days = [];
                for (let d = new Date(tripStartDate); d <= tripEndDate; d.setDate(d.getDate() + 1)) {
                    days.push(new Date(d));
                }

                const toDateOnly = (dateStr) => {
                    const date = new Date(`2025 ${dateStr}`);
                    return new Date(date.getFullYear(), date.getMonth(), date.getDate());
                };

                return (
                    <div className="bg-white p-6 rounded-lg shadow-md">
                        <h2 className="text-xl font-semibold mb-4">Daily Schedule & Headcount</h2>
                        <div className="space-y-4">
                            {days.map((date, index) => {
                                const formattedDate = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                                const currentDateOnly = new Date(date.getFullYear(), date.getMonth(), date.getDate());
                                
                                const travelersPresent = travelers.filter(t => {
                                    const arrivalDate = toDateOnly(t.arrival);
                                    const departureDate = toDateOnly(t.departure);

                                    return currentDateOnly >= arrivalDate && currentDateOnly <= departureDate && t.status === 'Confirmed';
                                });
                                return (
                                    <div key={index} className="border-b pb-3">
                                        <h3 className="font-semibold text-lg text-gray-800">{formattedDate} (<span className="text-blue-600">{travelersPresent.length}</span> present)</h3>
                                        <ul className="list-disc list-inside text-gray-600">
                                            {travelersPresent.length > 0 ?
                                                travelersPresent.map(t => <li key={t.id}>{t.name}</li>) :
                                                <li>No confirmed travelers present</li>
                                            }
                                        </ul>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };


            const Dashboard = () => {
                const confirmedExpenses = expenses.filter(e => e.status === 'Confirmed');
                const totalTravelers = travelers.length;
                const confirmedTravelersCount = travelers.filter(t => t.status === 'Confirmed').length;
                const planeTravelers = travelers.filter(t => t.transport === 'Plane').length;
                const trainTravelers = travelers.filter(t => t.transport === 'Train').length;

                const totalExpensesAmount = confirmedExpenses.reduce((sum, exp) => sum + exp.amount, 0);
                const averageExpensePerConfirmedTraveler = confirmedTravelersCount > 0 ? (totalExpensesAmount / confirmedTravelersCount) : 0;
                const pendingExpenses = expenses.filter(exp => exp.status === 'Pending').length;

                return (
                    <div className="bg-white p-6 rounded-lg shadow-md space-y-6">
                        <h2 className="text-xl font-semibold text-gray-800 mb-4">Trip Overview</h2>

                        {/* Top Bar */}
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-md shadow-sm flex items-center justify-between">
                                <div>
                                    <p className="text-2xl font-bold text-blue-700">{totalTravelers}</p>
                                    <p className="text-sm text-blue-600">Travelers (Total)</p>
                                </div>
                                <span className="text-blue-500 text-3xl">üë•</span>
                            </div>
                            <div className="bg-green-50 border-l-4 border-green-500 p-4 rounded-md shadow-sm flex items-center justify-between">
                                <div>
                                    <p className="text-2xl font-bold text-green-700">{confirmedTravelersCount}</p>
                                    <p className="text-sm text-green-600">Confirmed Travelers</p>
                                </div>
                                <span className="text-green-500 text-3xl">‚úÖ</span>
                            </div>
                            <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded-md shadow-sm flex items-center justify-between">
                                <div>
                                    <p className="text-2xl font-bold text-red-700">‚Çπ{totalExpensesAmount.toLocaleString()}</p>
                                    <p className="text-sm text-red-600">Confirmed Expenses</p>
                                </div>
                                <span className="text-red-500 text-3xl">üí∞</span>
                            </div>
                             <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-md shadow-sm flex items-center justify-between">
                                <div>
                                    <p className="text-2xl font-bold text-yellow-700">{pendingExpenses}</p>
                                    <p className="text-sm text-yellow-600">Pending Expenses</p>
                                </div>
                                <span className="text-yellow-500 text-3xl">‚è±Ô∏è</span>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {/* Financial Summary */}
                            <div className="bg-gray-50 p-4 rounded-lg shadow-sm border-l-4 border-purple-500">
                                <h3 className="text-lg font-semibold mb-3 text-purple-700">Financial Summary</h3>
                                <p className="text-gray-700 mb-1">Total Confirmed Expenses: <span className="font-medium">‚Çπ{totalExpensesAmount.toLocaleString()}</span></p>
                                <p className="text-gray-700 mb-1">Avg. Expense per Confirmed Traveler: <span className="font-medium">‚Çπ{averageExpensePerConfirmedTraveler.toFixed(2)}</span></p>
                                <p className="text-gray-700 mb-1">Plane Travelers: <span className="font-medium text-blue-700">{planeTravelers}</span></p>
                                <p className="text-gray-700">Train Travelers: <span className="font-medium text-blue-700">{trainTravelers}</span></p>
                            </div>

                            {/* Expense Breakdown (Example) */}
                            <div className="bg-gray-50 p-4 rounded-lg shadow-sm border-l-4 border-indigo-500">
                                <h3 className="text-lg font-semibold mb-3 text-indigo-700">Expense Type Breakdown</h3>
                                <p className="text-gray-700 mb-1">Equal Split: <span className="font-medium">{expenses.filter(e => e.splitType === 'Equal').length}</span></p>
                                <p className="text-gray-700 mb-1">Individual: <span className="font-medium">{expenses.filter(e => e.splitType === 'Individual').length}</span></p>
                                <p className="text-gray-700 mb-1">Custom: <span className="font-medium">{expenses.filter(e => e.splitType === 'Custom').length}</span></p>
                                <p className="text-gray-700">Total Expenses: <span className="font-medium">{expenses.length}</span></p>
                            </div>
                        </div>
                    </div>
                );
            };


            return (
                <div className="min-h-screen bg-gray-100 p-4 sm:p-6 font-sans">
                    {/* Header */}
                    <div className="max-w-7xl mx-auto mb-6 flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0 no-print">
                        <h1 className="text-3xl font-bold text-gray-800">Trip Planner 2025</h1>
                        <div className="flex items-center space-x-4">
                            <span className="text-gray-600">{travelers.length} Travelers</span>
                            <span className="text-gray-600">Nov 26 - Dec 1</span>
                        </div>
                    </div>

                    {/* Main Card Container */}
                    <div className="max-w-7xl mx-auto bg-white rounded-lg shadow-xl overflow-hidden">
                        {/* Tabs */}
                        <div className="border-b border-gray-200 bg-gray-50 no-print">
                            <nav className="-mb-px flex space-x-4 px-4 sm:px-6">
                                <TabButton name="travelers" label="Travelers" />
                                <TabButton name="expenses" label="Expenses" />
                                <TabButton name="schedule" label="Daily Schedule" />
                                <TabButton name="dashboard" label="Dashboard" />
                            </nav>
                        </div>

                        {/* Content Area */}
                        <div className="p-4 sm:p-6 overflow-y-auto max-h-[calc(100vh-200px)]"> {/* Adjust max-height as needed */}
                            {activeTab === 'travelers' && <TravelerList />}
                            {activeTab === 'expenses' && <ExpenseTable />}
                            {activeTab === 'schedule' && <DailySchedule />}
                            {activeTab === 'dashboard' && <Dashboard />}
                        </div>

                        {/* Footer / Data Management (Export/Import removed due to Firebase) */}
                        <div className="border-t border-gray-200 bg-gray-50 p-4 flex flex-col sm:flex-row justify-between items-center space-y-2 sm:space-y-0 no-print">
                            <p className="text-sm text-gray-500">Data is automatically synced with Firebase Firestore.</p>
                            <p className="text-sm text-gray-500">Last updated: {new Date().toLocaleString()}</p>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>